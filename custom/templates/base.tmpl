{#  -*- coding: utf-8 -*- #}
{% import 'base_helper.tmpl' as base with context %}
{{ set_locale(lang) }}
{{ base.html_headstart() }}
{% block extra_head %}
{#  Leave this block alone. #}
{% endblock %}
{{ template_hooks['extra_head']() }}
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">{{ messages("Skip to main content") }}</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
{% if theme_config.get('navbar_light') %}
navbar-light bg-light
{% else %}
navbar-dark bg-dark
{% endif %}
">
    <div class="container"><!-- This keeps the margins nice -->
        <a class="logo" href="{{ _link("root", None, lang) }}">
        {% if logo_url %}
            <img src="{{ logo_url }}" alt="{{ blog_title|e }}" id="logo" class="d-inline-block align-top">
        {% endif %}

        {% if show_blog_title %}
            <div id="blog-title">
                    {{ blog_title }}
                    <span id="blog-description">{{ blog_description }}</span>
            </div>
        {% endif %}
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
                {{ base.html_navigation_links_entries(navigation_links) }}
                {{ template_hooks['menu']() }}
            </ul>
            {% if search_form %}
                {{ search_form }}
            {% endif %}

            <ul class="navbar-nav navbar-right">
                {{ base.html_navigation_links_entries(navigation_alt_links) }}
                <li class="nav-item">
                    <button class="nav-link theme-toggle" id="theme-toggle" type="button" aria-pressed="false" aria-label="{{ messages('Theme auto tooltip') }}" title="{{ messages('Theme auto tooltip') }}" data-mode="auto">
                        <svg class="theme-icon theme-icon-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2V4a8 8 0 1 0 0 16z"></path></svg>
                        <svg class="theme-icon theme-icon-light" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg>
                        <svg class="theme-icon theme-icon-dark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"></path></svg>
                    </button>
                </li>
                {% block belowtitle %}
                {% if translations|length > 1 %}
                    <li>{{ base.html_translations() }}</li>
                {% endif %}
                {% endblock %}
                {% if show_sourcelink %}
                    {% block sourcelink %}{% endblock %}
                {% endif %}
                {{ template_hooks['menu_alt']() }}
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</nav>

<!-- End of Menubar -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        {{ template_hooks['page_header']() }}
        {% block extra_header %}{% endblock %}
        {% block content %}{% endblock %}
        <!--End of body content-->

        <footer id="footer">
            {{ content_footer }}
            {{ template_hooks['page_footer']() }}
            {% block extra_footer %}{% endblock %}
        </footer>
    </div>
</div>

{{ base.late_load_js() }}
    {% if date_fanciness != 0 %}
        <!-- fancy dates -->
        <script>
        moment.locale("{{ momentjs_locales[lang] }}");
        fancydates({{ date_fanciness }}, {{ js_date_format }});
        </script>
        <!-- end fancy dates -->
    {% endif %}
    {% block extra_js %}{% endblock %}
    <script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
    <script>
    (function() {
        var storageKey = 'theme-mode';
        var toggle = document.getElementById('theme-toggle');
        if (!toggle) return;
        var prefersDark = window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)') : null;
        var modes = ['auto', 'light', 'dark'];

        function savedMode() {
            var stored = localStorage.getItem(storageKey);
            if (modes.indexOf(stored) !== -1) {
                return stored;
            }
            return 'auto';
        }

        function resolvedTheme(mode) {
            if (mode === 'light' || mode === 'dark') return mode;
            return prefersDark && prefersDark.matches ? 'dark' : 'light';
        }

        function labels(mode, resolved) {
            if (mode === 'auto') {
                return {
                    aria: "{{ messages('Theme auto tooltip') }}",
                    next: 'light'
                };
            }
            if (mode === 'light') {
                return {
                    aria: "{{ messages('Theme light tooltip') }}",
                    next: 'dark'
                };
            }
            return {
                aria: "{{ messages('Theme dark tooltip') }}",
                next: 'auto'
            };
        }

        function apply(mode) {
            var resolved = resolvedTheme(mode);
            document.body.setAttribute('data-theme', resolved);
            document.body.setAttribute('data-theme-mode', mode);
            toggle.dataset.mode = mode;
            var label = labels(mode, resolved);
            toggle.setAttribute('aria-pressed', resolved === 'dark');
            toggle.setAttribute('aria-label', label.aria);
            toggle.setAttribute('title', label.aria);
        }

        function setMode(mode) {
            localStorage.setItem(storageKey, mode);
            apply(mode);
        }

        apply(savedMode());

        toggle.addEventListener('click', function() {
            var current = document.body.getAttribute('data-theme-mode') || savedMode();
            var next = labels(current).next;
            setMode(next);
        });

        if (prefersDark && prefersDark.addEventListener) {
            prefersDark.addEventListener('change', function() {
                if (savedMode() === 'auto') {
                    apply('auto');
                }
            });
        }
    })();
    </script>
{{ body_end }}
{{ template_hooks['body_end']() }}
</body>
</html>
